version: 2

sources:
  - name: main
    database: miptest_db
    loader: manual
    schema: dbt_dlawson
    tables:
      - name: load_amber__credits
        tests:
          - dbt_utils.unique_combination_of_columns:
              combination_of_columns:
                - nmi
                - effective_from
                - effective_to
                - type
                - amount_cents
      - name: load_amber__sites
        columns:
          - name: id
            tests:
              - unique
              - not_null
      - name: load_amber__subscription_fees
        tests:
          - dbt_utils.unique_combination_of_columns:
              combination_of_columns:
                - fee_type
                - monthly_fee
                - effective_from
                - effective_to
                - discount
      - name: load_amber__usage
        tests:
          - dbt_utils.unique_combination_of_columns:
              combination_of_columns:
                - site_id
                - start_time
        freshness:
          warn_after:
            count: 3
            period: day
          error_after:
            count: 14
            period: day
        loaded_at_field: "nem_time_start"
      - name: load__vdo
        tests:
          - dbt_utils.unique_combination_of_columns:
              combination_of_columns:
                - distribution_zone
                - effective_from
                - effective_to
        freshness:
          warn_after:
            count: 1
            period: day
          error_after:
            count: 30
            period: day
        loaded_at_field: "effective_to::timestamp"
      - name: load_opennem__temperature
        tests:
            - dbt_utils.unique_combination_of_columns:
                name: load_opennem__temperature_unique
                combination_of_columns:
                    - timestamp
                    - id
        freshness:
          warn_after:
            count: 7
            period: day
          error_after:
            count: 14
            period: day
        loaded_at_field: "timestamp"

